<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>React Context</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"
    />
  </head>

  <body>
    <div id="root">React Context</div>
    <script>
      const REACT_CONTEXT_TYPE = symbolFor("react.context");
      const REACT_PROVIDER_TYPE = symbolFor("react.provider");
      function createContext(defaultValue, calculateChangedBits = null) {
        var context = {
          $$typeof: REACT_CONTEXT_TYPE,
          _calculateChangedBits: calculateChangedBits,
          _currentValue: defaultValue,
          _currentValue2: defaultValue,
          _threadCount: 0, // 用于concurrent renderers
          Provider: null,
          Consumer: null,
        };
        context.Provider = {
          $$typeof: REACT_PROVIDER_TYPE,
          _context: context,
        };

        context.Consumer = context;

        return context;
      }
      var valueStack = [];

      function createCursor(defaultValue) {
        return {
          current: defaultValue,
        };
      }
      var valueCursor = createCursor(null);
      function push(cursor, value, fiber) {
        index++;
        valueStack[index] = cursor.current;

        cursor.current = value;
      }
      function pushProvider(providerFiber, nextValue) {
        var context = providerFiber.type._context;

        push(valueCursor, context._currentValue);
        context._currentValue = nextValue;
      }
      function updateContextProvider(current, workInProgress, renderLanes) {
        var providerType = workInProgress.type; // workInProgress.type的值就是context.Provider
        var context = providerType._context;
        var newProps = workInProgress.pendingProps;
        var oldProps = workInProgress.memoizedProps;
        var newValue = newProps.value;

        pushProvider(workInProgress, newValue);

        var newChildren = newProps.children;
        reconcileChildren(current, workInProgress, newChildren, renderLanes);
        return workInProgress.child;
      }
    </script>
  </body>
</html>
