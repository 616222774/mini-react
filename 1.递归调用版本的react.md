### 简单的react
```jsx harmony
// 以这个jsx元素为例
// const element = (
//     <div id="foo">
//         this is a text
//         <div>
//             <a>this is a link</a>
//             bar
//         </div>
//         <br />
//     </div>
// )
const createTextElement = (text) => {
    return {
        type: "TEXT_ELEMENT",
        props: {
            nodeValue: text,
            children: [],
        }
    }
}

// children数组可能为空数组，数组中也可能包括基本的类型值，比如数字或者字符串
// 在react的代码中：
// 1.当children不存在时，react并不会创建一个空的数组。
// 2.如果数组中有基本类型值，如数字或者字符串，react也不会对这些基本类型值做特殊处理。
// 在我们的mini-react中，为了简化代码，我们使用特殊的类型TEXT_ELEMENT包装工基本的类型值
const createElement = (type, props, ...children) => {
    return {
        type,
        props: {
            ...props,
            children: children.map(child =>
                typeof child === 'object' ?
                    child
                    :
                    createTextElement(child)
            ),
        }
    }
}
const element = createElement(
    'div',
    { id: 'foo' },
    "this is a text",
    React.createElement('div', null, React.createElement('a', null, 'this is a link'), 'bar'),
    React.createElement('br')
)

const container = document.getElementById('root');

const render = (element, container) => {
    const dom = element.type === 'TEXT_ELEMENT' ?
        document.createTextNode('') :
        document.createElement(element.type);

    const isProperty = key => key !== 'children';

    Object
        .keys(element.props)
        .filter(isProperty)
        .forEach(name => {
            dom[name] = element.props[name]
        })

    element.props.children.forEach(child => {
        render(child, dom);
    })
    container.appendChild(dom);
}

render(element, container)
```

### 问题
现在我们已经有一个能把jsx渲染到dom上的简单库。但是，很明显这个递归render存在问题。
一旦我们开始render，这个过程是不能终止的。如果virtual dom树 很深很大，很可能会长时间阻塞
主线程。如果浏览器需要执行优先级更高的任务，比如处理用户输入或者动画，那就必须等到render执行完成。


因此我们需要将这个render任务拆分成小的执行单元。在执行完成每个单元后，允许浏览器
打断这个render执行过程，并处理其他优先级高的任务。


我们使用requestIdleCallback实现一个循环。但真实的react代码并不是使用requestIdleCallback，
而是使用 scheduler package.
